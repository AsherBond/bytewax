<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Writing API Documentation &#8212; Bytewax API Docs  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=c631c1db" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />

  <link rel="stylesheet" href="_static/custom.css" type="text/css" />





  </head><body>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">


          <div class="body" role="main">

  <section id="writing-api-documentation">
<h1>Writing API Documentation<a class="headerlink" href="#writing-api-documentation" title="Link to this heading">¶</a></h1>
<p>API documentation is Markdown files in the <code class="docutils literal notranslate"><span class="pre">/apidocs</span></code> folder. It is
built using <a class="reference external" href="https://www.sphinx-doc.org/en/master/">Sphinx</a> and
<a class="reference external" href="https://myst-parser.readthedocs.io/en/latest/index.html">MyST</a> for
Markdown parsing.</p>
<section id="myst-cheat-sheet">
<h2>MyST Cheat Sheet<a class="headerlink" href="#myst-cheat-sheet" title="Link to this heading">¶</a></h2>
<p>Here’s a quick rundown of common things in MyST flavored Markdown.</p>
<section id="docstrings">
<h3>Docstrings<a class="headerlink" href="#docstrings" title="Link to this heading">¶</a></h3>
<p>Docstrings can be written using the all the features of MyST. Some
docstring-specific hints will be provided here.</p>
<section id="arguments">
<h4>Arguments<a class="headerlink" href="#arguments" title="Link to this heading">¶</a></h4>
<p>Docstrings should use MyST Markdown as the text body. Arguments,
return values, etc. specified using <a class="reference external" href="https://myst-parser.readthedocs.io/en/latest/syntax/optional.html#syntax-fieldlists" title="MyST Parser 2.0.0">MyST field
lists</a> which are <code class="docutils literal notranslate"><span class="pre">:name</span> <span class="pre">value:</span> <span class="pre">Description</span></code> lines. The field names should be the same as the
<a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/domains/python.html#info-field-lists" title="Sphinx 7.3.0">Sphinx</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">my_func</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Do the cool thing.</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="sd">    :arg x: Describe the X parameter.</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="sd">    :arg y: Describe the Y parameter. If this is a really long line,</span>
<span class="linenos"> 7</span><span class="sd">        you can wrap it with indentation. You can also use any</span>
<span class="linenos"> 8</span><span class="sd">        **syntax** here you like.</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="sd">    :returns: A description of the return value.</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">13</span>    <span class="o">...</span>
</pre></div>
</div>
<p>If the function signature is coming from PyO3 (and thus there are no
type hints in the code) you can use the <code class="docutils literal notranslate"><span class="pre">:type</span> <span class="pre">var:</span></code> and <code class="docutils literal notranslate"><span class="pre">:rtype:</span></code>
fields to provide argument and return value type hints.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="sd">/// Do the cool thing.</span>
<span class="sd">///</span>
<span class="sd">/// :arg x: Describe the X parameter.</span>
<span class="sd">///</span>
<span class="sd">/// :type x: int</span>
<span class="sd">///</span>
<span class="sd">/// :arg y: Describe the Y parameter. If this is a really long line,</span>
<span class="sd">///     you can wrap it with indentation. You can also use any</span>
<span class="sd">///     **syntax** here you like.</span>
<span class="sd">///</span>
<span class="sd">/// :type y: str</span>
<span class="sd">///</span>
<span class="sd">/// :returns: A description of the return value.</span>
<span class="sd">///</span>
<span class="sd">/// :rtype: str</span>
<span class="cp">#[pyfunction]</span>
<span class="k">fn</span> <span class="nf">my_func</span><span class="p">(</span><span class="n">x</span>: <span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="nb">String</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span> <span class="p">{</span>
<span class="w">    </span><span class="fm">todo!</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="class-and-module-variables">
<h4>Class and Module Variables<a class="headerlink" href="#class-and-module-variables" title="Link to this heading">¶</a></h4>
<p>You can add “post-variable docstrings” to document these.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="n">X</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
<span class="linenos"> 6</span><span class="sd">&quot;&quot;&quot;Type of a cool thing.&quot;&quot;&quot;</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="nd">@dataclass</span>
<span class="linenos">10</span><span class="k">class</span> <span class="nc">Container</span><span class="p">:</span>
<span class="linenos">11</span>    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
<span class="linenos">12</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the docstring for this attribute.&quot;&quot;&quot;</span>
<span class="linenos">13</span>
<span class="linenos">14</span>    <span class="n">y</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos">15</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the docstring for this other attribute.&quot;&quot;&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="cross-references">
<h3>Cross References<a class="headerlink" href="#cross-references" title="Link to this heading">¶</a></h3>
<p>See <a class="reference external" href="https://myst-parser.readthedocs.io/en/latest/syntax/cross-referencing.html" title="MyST Parser 2.0.0">MyST’s documentation on cross
referencing</a> for all the ways this
can work. I’ll give a quick summary here.</p>
<section id="api-docs">
<h4>API Docs<a class="headerlink" href="#api-docs" title="Link to this heading">¶</a></h4>
<p>To link to a symbol in the Bytewax library, use the full dotted path
to it surrounded by <code class="docutils literal notranslate"><span class="pre">`</span></code> and proceeded by <code class="docutils literal notranslate"><span class="pre">{py:obj}</span></code>.</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>This operator returns a {py:obj}`bytewax.dataflow.Stream`.
</pre></div>
</div>
<p>Appears as:</p>
<blockquote>
<div><p>This operator returns a <a class="reference internal" href="api/bytewax/bytewax.dataflow.html#bytewax.dataflow.Stream" title="bytewax.dataflow.Stream"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytewax.dataflow.Stream</span></code></a>.</p>
</div></blockquote>
<p>You should always use the full dotted path to reference a name, but if
you don’t want it to appear as a full dotted path because of the
context of the surrounding text, prefix the path with <code class="docutils literal notranslate"><span class="pre">~</span></code>.</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>This operator returns a {py:obj}`~bytewax.dataflow.Stream`.
</pre></div>
</div>
<p>Appears as:</p>
<blockquote>
<div><p>This operator returns a <a class="reference internal" href="api/bytewax/bytewax.dataflow.html#bytewax.dataflow.Stream" title="bytewax.dataflow.Stream"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Stream</span></code></a>.</p>
</div></blockquote>
</section>
</section>
<section id="example-code">
<h3>Example Code<a class="headerlink" href="#example-code" title="Link to this heading">¶</a></h3>
<p>Use backtick code blocks with the <code class="docutils literal notranslate"><span class="pre">python</span></code> language type.</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="sb">```python</span>
<span class="n">flow</span> <span class="o">=</span> <span class="n">Dataflow</span><span class="p">()</span>
<span class="sb">```</span>
</pre></div>
</div>
</section>
<section id="shell-sessions">
<h3>Shell Sessions<a class="headerlink" href="#shell-sessions" title="Link to this heading">¶</a></h3>
<p>Use the language type <code class="docutils literal notranslate"><span class="pre">console</span></code> (instead of <code class="docutils literal notranslate"><span class="pre">bash</span></code>), and start
commands you run with <code class="docutils literal notranslate"><span class="pre">$</span></code> to get proper highlighting.</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="sb">```console</span>
<span class="gp">$ </span>waxctl<span class="w"> </span>list
<span class="go">output here</span>
<span class="sb">```</span>
</pre></div>
</div>
<p>Appears as:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>waxctl<span class="w"> </span>list
<span class="go">output here</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="mermaid-diagrams">
<h3>Mermaid Diagrams<a class="headerlink" href="#mermaid-diagrams" title="Link to this heading">¶</a></h3>
<p>We have install the Sphinx
<a class="reference external" href="https://sphinxcontrib-mermaid-demo.readthedocs.io/en/latest/"><code class="docutils literal notranslate"><span class="pre">sphinxcontrib-mermaid</span></code></a>
plugin which allows you to use <code class="docutils literal notranslate"><span class="pre">mermaid</span></code> as a code block language
name.</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="sb">```mermaid</span>
<span class="s">graph TD</span>

<span class="s">I1[Kafka Consumer `users`] --&gt; D1[Users Deserializer] --&gt; K1[Key on User ID]</span>
<span class="s">I2[Kafka Consumer `transactions`] --&gt; D2[Transactions Deserializer] --&gt; K2[Key on User ID]</span>

<span class="s">K1 &amp; K2 --&gt; J1[Join on User ID] --&gt; V[Validator] --&gt; S[Enriched Serializer] --&gt; O1[Kafka Producer `enriched_txns`]</span>
<span class="s">V --&gt; O2[Kafka Producer `enriched_txns_dead_letter_queue`]</span>
<span class="sb">```</span>
</pre></div>
</div>
<p>Appears as:</p>
<div class="mermaid">
            graph TD

I1[Kafka Consumer `users`] --&gt; D1[Users Deserializer] --&gt; K1[Key on User ID]
I2[Kafka Consumer `transactions`] --&gt; D2[Transactions Deserializer] --&gt; K2[Key on User ID]

K1 &amp; K2 --&gt; J1[Join on User ID] --&gt; V[Validator] --&gt; S[Enriched Serializer] --&gt; O1[Kafka Producer `enriched_txns`]
V --&gt; O2[Kafka Producer `enriched_txns_dead_letter_queue`]
        </div></section>
</section>
<section id="build-process">
<h2>Build Process<a class="headerlink" href="#build-process" title="Link to this heading">¶</a></h2>
<p>API reference documentation is automatically during the Sphinx build
process via the <a class="reference external" href="https://sphinx-autodoc2.readthedocs.io/en/latest/index.html"><code class="docutils literal notranslate"><span class="pre">sphinx-autodoc2</span></code>
extension</a>
generated from our Python source in <code class="docutils literal notranslate"><span class="pre">/pysrc</span></code>. The build process turns
the source into automatically generated Markdown files in
<code class="docutils literal notranslate"><span class="pre">/apidocs/api</span></code>, which are then passed through the Sphinx builder.</p>
<p>The built HTML files are put in <code class="docutils literal notranslate"><span class="pre">/apidocs/html</span></code>. This is what should
be served.</p>
<section id="pipenv">
<h3>Pipenv<a class="headerlink" href="#pipenv" title="Link to this heading">¶</a></h3>
<p>I have setup <a class="reference external" href="https://pipenv.pypa.io/en/latest/"><code class="docutils literal notranslate"><span class="pre">pipenv</span></code></a> as the way
to manage the blessed environment for building documentation because
it supports creating reproducible environments. It lets you pin a
specific version of the Python interpreter and all packages. These are
saved via <code class="docutils literal notranslate"><span class="pre">/apidocs/Pipfile</span></code> and <code class="docutils literal notranslate"><span class="pre">/apidocs/Pipfile.lock</span></code>.</p>
<p>You should install the latest version of <code class="docutils literal notranslate"><span class="pre">pipenv</span></code> globally and it will
use the lockfile in the current directory. It won’t affect any other
Python environment tooling.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>pipenv
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pipenv</span></code> will automatically use
<a class="reference external" href="https://github.com/pyenv/pyenv"><code class="docutils literal notranslate"><span class="pre">pyenv</span></code></a> to install the correct
version of the Python interpreter to make things consistent.</p>
<p>You should use the two build scripts below which automatically setup
<code class="docutils literal notranslate"><span class="pre">pipenv</span></code> for you.</p>
</section>
<section id="auto-builder">
<h3>Auto Builder<a class="headerlink" href="#auto-builder" title="Link to this heading">¶</a></h3>
<p>The quickest way to iterate on your docs is to run the
<code class="docutils literal notranslate"><span class="pre">./autobuild.sh</span></code> script from the <code class="docutils literal notranslate"><span class="pre">/apidocs</span></code> directory.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>apidocs
<span class="gp">$ </span>./autobuild.sh
<span class="go">Creating a virtualenv for this project...</span>
<span class="go">...</span>
<span class="go">All dependencies are now up-to-date!</span>
<span class="go">...</span>
<span class="go">Running Sphinx v7.2.6</span>
<span class="go">...</span>
<span class="go">[I 240124 12:03:11 server:335] Serving on http://127.0.0.1:8000</span>
</pre></div>
</div>
<p>This starts a web server on <a class="reference external" href="http://localhost:8000/">http://localhost:8000/</a> with the built
docs and will watch the source files and rebuild on any change.</p>
</section>
<section id="committing-changes">
<h3>Committing Changes<a class="headerlink" href="#committing-changes" title="Link to this heading">¶</a></h3>
<p>Before a release, the updated docs should be committed into the repo.
Use the <code class="docutils literal notranslate"><span class="pre">./build.sh</span></code> script run from the <code class="docutils literal notranslate"><span class="pre">/apidocs</span></code> directory.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>apidocs
<span class="gp">$ </span>./build.sh
</pre></div>
</div>
<p>Then commit the updated <code class="docutils literal notranslate"><span class="pre">/apidocs/html</span></code> directory.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>add<span class="w"> </span>html
<span class="gp">$ </span>git<span class="w"> </span>commit
</pre></div>
</div>
</section>
</section>
</section>


          </div>

        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><ul>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">


    </div>




  </body>
</html>
